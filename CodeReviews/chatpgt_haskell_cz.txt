Promt:

Dej mi code review pro tento pull request:

diff --git a/src/Main.hs b/src/Main.hs
index 310e9ee..081deba 100644
\--- a/src/Main.hs
+++ b/src/Main.hs
@@ -1,10 +1,31 @@
import System.Random (randomRIO)
-import Control.Monad (replicateM)
-import Data.List (intercalate)
+import Control.Monad (replicateM, when)
+import Data.List (intercalate, sort)
+import System.IO (hFlush, stdout)
+import Data.Time.Clock (getCurrentTime)
+import Data.Time.Format (formatTime, defaultTimeLocale)
+import System.Directory (createDirectoryIfMissing)
+import qualified Data.Map as Map

\-- DatovÃ© typy pro nÃ¡lady a tÃ©mata
-data Mood = Happy | Sad | Reflective deriving (Show, Enum, Bounded)
-data Theme = Rain | Forest | Night | City deriving (Show, Enum, Bounded)
+data Mood = Happy | Sad | Reflective | Anxious | Nostalgic

* deriving (Show, Enum, Bounded, Eq, Ord)
*

+data Theme = Rain | Forest | Night | City | Ocean | Mountain | Desert

* deriving (Show, Enum, Bounded, Eq, Ord)
*

+-- DatovÃ¡ struktura pro uklÃ¡dÃ¡nÃ­ historie
+data HaikuHistory = HaikuHistory {

* poemText :: String,
* poemMood :: Mood,
* poemTheme :: Theme,
* timestamp :: String
  +} deriving (Show)
*

+-- GlobÃ¡lnÃ­ historie bÃ¡snÃ­
+type HaikuHistoryMap = Map.Map Int HaikuHistory
+haikuHistory :: HaikuHistoryMap
+haikuHistory = Map.empty

\-- PomocnÃ¡ funkce pro vÃ½bÄ›r nÃ¡hodnÃ©ho prvku
randomFrom :: \[a] -> IO a
@@ -12,15 +33,59 @@ randomFrom xs = do
idx <- randomRIO (0, length xs - 1)
return (xs !! idx)

\--- VÃ½bÄ›r z pÅ™edem definovanÃ½ch moÅ¾nostÃ­
-promptChoice :: (Show a, Enum a, Bounded a) => String -> IO a
+-- VylepÅ¡enÃ¡ funkce pro vÃ½bÄ›r z moÅ¾nostÃ­ s potvrzenÃ­m
+promptChoice :: (Show a, Enum a, Bounded a, Ord a) => String -> IO a
promptChoice label = do
putStrLn \$ "\n" ++ label

* let options = \[minBound .. maxBound]

- let options = sort \[minBound .. maxBound]
  mapM\_ ((i, opt) -> putStrLn \$ show i ++ ". " ++ show opt) (zip \[1..] options)

* putStr "Zadej ÄÃ­slo: "

- putStr "Zadej ÄÃ­slo (nebo 0 pro nÃ¡hodnÃ½ vÃ½bÄ›r): "
- hFlush stdout  -- ZajistÃ­, Å¾e se prompt okamÅ¾itÄ› zobrazÃ­
  idx <- readLn

* return (options !! (idx - 1))

- if idx == 0
- then randomFrom options
- else if idx >= 1 && idx <= length options
- ```
      then return (options !! (idx - 1))
  ```
- ```
      else do
  ```
- ```
        putStrLn "NeplatnÃ¡ volba, zkus to znovu."
  ```
- ```
        promptChoice label
  ```
-

+-- Funkce pro ovÄ›Å™enÃ­, zda haiku splÅˆuje poÅ¾adovanÃ½ poÄet slabik (5-7-5)
+validateHaiku :: String -> Bool
+validateHaiku poem =

* let lines = words <\$> lines poem
* ```
   counts = map length lines
  ```
* in  length counts == 3 && counts == \[5, 7, 5]
*

+-- Funkce pro uloÅ¾enÃ­ vygenerovanÃ©ho haiku do historie
+saveHaiku :: String -> Mood -> Theme -> IO Int
+saveHaiku poem mood theme = do

* currentTime <- getCurrentTime
* let timeStr = formatTime defaultTimeLocale "%Y-%m-%d %H:%M:%S" currentTime
* ```
   newHistory = HaikuHistory poem mood theme timeStr
  ```
* ```
   newId = Map.size haikuHistory + 1
  ```
* return newId
*

+-- Funkce pro export haiku do souboru
+exportHaiku :: String -> Mood -> Theme -> IO ()
+exportHaiku poem mood theme = do

* currentTime <- getCurrentTime
* let timeStr = formatTime defaultTimeLocale "%Y%m%d%H%M%S" currentTime
* ```
   fileName = "haiku_" ++ show mood ++ "_" ++ show theme ++ "_" ++ timeStr ++ ".txt"
  ```
* ```
   folderPath = "output"
  ```
*
* \-- VytvoÅ™enÃ­ sloÅ¾ky, pokud neexistuje
* createDirectoryIfMissing True folderPath
*
* \-- UloÅ¾enÃ­ bÃ¡snÄ› do souboru
* writeFile (folderPath ++ "/" ++ fileName) \$
* "Haiku\n" ++
* "Mood: " ++ show mood ++ "\n" ++
* "Theme: " ++ show theme ++ "\n" ++
* "Date: " ++ formatTime defaultTimeLocale "%Y-%m-%d %H:%M:%S" currentTime ++ "\n\n" ++
* poem
*
* putStrLn \$ "Haiku uloÅ¾eno do souboru: " ++ fileName

\-- SlovnÃ­ky podle nÃ¡lady a tÃ©matu
getWordLists :: Mood -> Theme -> (\[String], \[String], \[String])
@@ -39,6 +104,18 @@ getWordLists Reflective Rain =
, \["Thoughts like rivers slowly pass", "Puddles mirror what I am"]
, \["Grey clouds drift within", "Past lives drip away"]
)
+-- PÅ™idanÃ¡ novÃ¡ kombinace pro Anxious City
+getWordLists Anxious City =

* ( \["Traffic roars like waves", "Ticking clocks too loud"]
* , \["Crowds swarm through concrete canyons", "Eyes avoid meeting strangers' gaze"]
* , \["Heart beats much too fast", "No peace in this place"]
* )
  +-- PÅ™idanÃ¡ novÃ¡ kombinace pro Nostalgic Ocean
  +getWordLists Nostalgic Ocean =
* ( \["Childhood shores return", "Salt spray on my lips"]
* , \["Memories float on gentle tides", "Seashells whisper stories old"]
* , \["Time washed out to sea", "Waves bring past to shore"]
* )
  getWordLists \_ \_ =
  ( \["Leaves fall quietly", "Silent moonlight shines"]
  , \["Dreams awaken under trees", "Lanterns glow in distant mist"]
  @@ -54,13 +131,79 @@ generateHaiku mood theme = do
  l3 <- randomFrom l3s
  return \$ intercalate "\n" \[l1, l2, l3]

\--- HlavnÃ­ funkce
+-- GenerovÃ¡nÃ­ sekvence haiku
+generateHaikuSequence :: Int -> Mood -> Theme -> IO \[String]
+generateHaikuSequence count mood theme

* \| count <= 0 = return \[]
* \| otherwise = do
* ```
   sequence <- replicateM count (generateHaiku mood theme)
  ```
* ```
   return sequence
  ```
*

+-- ZobrazenÃ­ menu
+showMenu :: IO ()
+showMenu = do

* putStrLn "\nVyber akci:"
* putStrLn "1. Vygenerovat jedno haiku"
* putStrLn "2. Vygenerovat sekvenci haiku"
* putStrLn "3. Exportovat haiku do souboru"
* putStrLn "4. Konec"
* putStr "TvÃ¡ volba: "
* hFlush stdout
*

+-- HlavnÃ­ funkce programu
main :: IO ()
main = do

* putStrLn "VÃ­tej v generÃ¡toru Haiku!"
* mood <- promptChoice "Vyber nÃ¡ladu:"
* theme <- promptChoice "Vyber tÃ©ma:"
* putStrLn "\nVygenerovanÃ© Haiku:"
* putStrLn "--------------------"
* poem <- generateHaiku mood theme
* putStrLn poem

- putStrLn "VÃ­tej v generÃ¡toru Haiku 2.0!"
- mainLoop
-

+mainLoop :: IO ()
+mainLoop = do

* showMenu
* choice <- readLn
* case choice of
* 1 -> do
* ```
   mood <- promptChoice "Vyber nÃ¡ladu:"
  ```
* ```
   theme <- promptChoice "Vyber tÃ©ma:"
  ```
* ```
   putStrLn "\nVygenerovanÃ© Haiku:"
  ```
* ```
   putStrLn "--------------------"
  ```
* ```
   poem <- generateHaiku mood theme
  ```
* ```
   putStrLn poem
  ```
*
* ```
   when (not $ validateHaiku poem) $
  ```
* ```
     putStrLn "UpozornÄ›nÃ­: Toto haiku nemusÃ­ dodrÅ¾ovat tradiÄnÃ­ formÃ¡t 5-7-5 slabik."
  ```
*
* ```
   -- UloÅ¾enÃ­ do historie
  ```
* ```
   _ <- saveHaiku poem mood theme
  ```
* ```
   mainLoop
  ```
*
* 2 -> do
* ```
   mood <- promptChoice "Vyber nÃ¡ladu:"
  ```
* ```
   theme <- promptChoice "Vyber tÃ©ma:" 
  ```
* ```
   putStr "Kolik haiku chceÅ¡ vygenerovat? "
  ```
* ```
   hFlush stdout
  ```
* ```
   count <- readLn
  ```
* ```
   putStrLn "\nVygenerovanÃ¡ sekvence Haiku:"
  ```
* ```
   putStrLn "-------------------------"
  ```
* ```
   sequence <- generateHaikuSequence count mood theme
  ```
* ```
   mapM_ (\(i, p) -> do
  ```
* ```
       putStrLn $ "Haiku #" ++ show i ++ ":"
  ```
* ```
       putStrLn p
  ```
* ```
       putStrLn ""
  ```
* ```
     ) $ zip [1..] sequence
  ```
* ```
   mainLoop
  ```
*
* 3 -> do
* ```
   mood <- promptChoice "Vyber nÃ¡ladu:"
  ```
* ```
   theme <- promptChoice "Vyber tÃ©ma:"
  ```
* ```
   putStrLn "\nVygenerovanÃ© Haiku k exportu:"
  ```
* ```
   putStrLn "----------------------------"
  ```
* ```
   poem <- generateHaiku mood theme
  ```
* ```
   putStrLn poem
  ```
* ```
   exportHaiku poem mood theme
  ```
* ```
   mainLoop
  ```
*
* 4 -> putStrLn "DÄ›kuji za pouÅ¾itÃ­ generÃ¡toru Haiku. Nashledanou!"
*
* \_ -> do
* ```
   putStrLn "NeplatnÃ¡ volba, zkus to znovu."
  ```
* ```
   mainLoop
  ```





DÃ­ky za sdÃ­lenÃ­ pull requestu. NÃ­Å¾e najdeÅ¡ detailnÃ­ code review rozdÄ›lenÃ© do nÄ›kolika sekcÃ­:

---

## âœ… **Pozitiva**

1. **ZvÄ›tÅ¡enÃ½ rozsah funkcionality:**

   * PÅ™idÃ¡nÃ­ novÃ½ch nÃ¡lad (`Anxious`, `Nostalgic`) a tÃ©mat (`Ocean`, `Mountain`, `Desert`) zvyÅ¡uje variabilitu vÃ½stupÅ¯.
   * ZavedenÃ­ hlavnÃ­ho menu a hlavnÃ­ho loopu (`mainLoop`) ÄinÃ­ program interaktivnÄ›jÅ¡Ã­m a opakovanÄ› pouÅ¾itelnÃ½m.

2. **UÅ¾ivatelskÃ¡ pÅ™Ã­vÄ›tivost:**

   * MoÅ¾nost nÃ¡hodnÃ©ho vÃ½bÄ›ru (volba `0`) je intuitivnÃ­ a praktickÃ¡.
   * `promptChoice` je teÄ robustnÄ›jÅ¡Ã­ dÃ­ky kontrole vstupu a opÄ›tovnÃ©mu dotazu na chybnou volbu.

3. **Modularita a Äistota:**

   * VÄ›tÅ¡ina logiky byla rozdÄ›lena do samostatnÃ½ch funkcÃ­ (`generateHaikuSequence`, `validateHaiku`, `exportHaiku`), coÅ¾ zvyÅ¡uje Äitelnost a opÄ›tovnou pouÅ¾itelnost.

4. **PÅ™Ã­prava na persistenci:**

   * ZavedenÃ­ `HaikuHistory` a `saveHaiku` ukazuje smÄ›r k moÅ¾nÃ©mu logovÃ¡nÃ­ nebo historii, i kdyÅ¾ aktuÃ¡lnÄ› jen simuluje uloÅ¾enÃ­.

---

## ğŸ› ï¸ **NÃ¡vrhy na zlepÅ¡enÃ­**

### 1. **`validateHaiku` nenÃ­ sprÃ¡vnÄ›:**

```haskell
validateHaiku poem = 
  let lines = words <$> lines poem
      counts = map length lines
```

* Tady dojde k *shadowingu* promÄ›nnÃ© `lines`.
* NavÃ­c `words <$> lines` aplikuje `words` na kaÅ¾dou Å™Ã¡dku, ÄÃ­mÅ¾ spoÄÃ­tÃ¡Å¡ poÄet slov, ne slabik.
* Pokud mÃ¡Å¡ za cÃ­l validovat strukturu podle poÄtu Å™Ã¡dkÅ¯, udÄ›lej napÅ™.:

  ```haskell
  validateHaiku poem = 
    let lineCount = length (lines poem)
    in lineCount == 3
  ```
* Pokud chceÅ¡ validovat slabiky, budeÅ¡ muset implementovat heuristickÃ© poÄÃ­tÃ¡nÃ­ slabik v angliÄtinÄ›, coÅ¾ nenÃ­ ÃºplnÄ› triviÃ¡lnÃ­.

### 2. **`saveHaiku` neuklÃ¡dÃ¡ nic do `haikuHistory`:**

```haskell
-- haikuHistory = Map.empty
```

* Tato promÄ›nnÃ¡ je *immutable* a nenÃ­ moÅ¾nÃ© ji modifikovat bez pouÅ¾itÃ­ IORef, MVar apod.
* Navrhuj buÄ:

  * PÅ™edat a vracet `HaikuHistoryMap` jako parametr,
  * nebo uklÃ¡dat haiku rovnou do souboru nebo do SQLite/json, pokud chceÅ¡ perzistenci.

### 3. **Magic constants a pÅ™eklad UI:**

* Menu a UI jsou napÅ¯l Äesky, napÅ¯l anglicky (â€Haikuâ€œ, `Mood`, `Theme` atd.). BuÄ vÅ¡e pÅ™eloÅ¾, nebo konzistentnÄ› ponech anglicky.
* Magic stringy jako `"output"` by mohly bÃ½t promÄ›nnÃ½mi.

### 4. **DuplicitnÃ­ vÃ½poÄet Äasu v `exportHaiku`:**

```haskell
currentTime <- getCurrentTime
...
"Date: " ++ formatTime defaultTimeLocale "%Y-%m-%d %H:%M:%S" currentTime
```

* DuplicitnÃ­ formatovÃ¡nÃ­ by mohlo bÃ½t refaktorovÃ¡no do jednÃ© promÄ›nnÃ©.

---

## ğŸ’¡ **MoÅ¾nosti vylepÅ¡enÃ­ do budoucna**

* âœ… PÅ™idat reÃ¡lnÃ© poÄÃ­tÃ¡nÃ­ slabik (napÅ™. pomocÃ­ nÄ›jakÃ©ho heuristickÃ©ho algoritmu).
* âœ… PÅ™idat moÅ¾nost vÃ½pisu pÅ™edchozÃ­ch haiku (z historie).
* ğŸ’¾ UklÃ¡dÃ¡nÃ­ historie do JSON nebo SQLite.
* ğŸŒ PÅ™idÃ¡nÃ­ webovÃ©ho UI napÅ™. pomocÃ­ Scotty nebo Servant.

---

## ğŸ”š ZÃ¡vÄ›r

Tento pull request je velmi kvalitnÃ­ krok smÄ›rem ke komplexnÄ›jÅ¡Ã­mu generÃ¡toru haiku. DobÅ™e oddÄ›lenÃ¡ logika, rozÅ¡Ã­Å™enÃ¡ funkcionalita a interaktivnÃ­ menu ukazujÃ­ na promyÅ¡lenÃ½ nÃ¡vrh. VÄ›tÅ¡ina problÃ©mÅ¯ je spÃ­Å¡e technickÃ©ho charakteru a mÅ¯Å¾e bÃ½t snadno opravena.

ChceÅ¡, abych ti navrhl refaktor pro `validateHaiku` nebo perzistentnÃ­ uklÃ¡dÃ¡nÃ­ historie?
